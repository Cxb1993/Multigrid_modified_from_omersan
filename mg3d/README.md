Extended the 2d code to 3D...
